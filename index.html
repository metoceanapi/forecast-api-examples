<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <title>Forecast API JavaScript Examples</title>
  </head>
  <body>
    <label for='apikey'>API Key:</label>
    <input id='apikey' type='text' name='apikey'></input>
    <br>
    <label for='example'>Example:</label>
    <!-- TODO generate examples -->
    <select name='example' id="examples">
      <option value='pointTime'>Point Time</option>
      <option value='pointTimeWindVectors'>Point Time Wind Vectors</option>
      <option value='pointTimeMasks'>Point Time Masks</option>
      <option value='pointTimeBase64'>Point Time Base64</option>
    </select>
    <br>
    <button id='run'>Run</button>
    <br>
    <pre id='response'></pre>
    <pre id='processed'></pre>
  </body>
  <script type='module'>
    import { makeOptions, fetcher } from './index.js'
    import { examples } from './examples.js'

    function execute() {
      let key = document.getElementById('apikey').value
      let exampleName = document.getElementById('examples').value
      let example = examples[exampleName]
      let options = makeOptions(example.data, key)
      fetcher(example.url, options, function(data) {
        console.log('API response JSON:', data)
        document.getElementById('response').innerHTML = JSON.stringify(data, null, 2);

        if (!example.cb) {
          return
        }
        let processed = example.cb(data)
        if (processed === undefined) {
          return
        }
        console.log('Processed:', processed)
        document.getElementById('processed').innerHTML = JSON.stringify(processed, null, 2);
      })
    }
    document.querySelector('#run').addEventListener('click', execute)
  </script>
</html>
