<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <title>Forecast API JavaScript Examples</title>
  </head>
  <body>
    <!-- hack to make the apikey input autofill nicely -->
    <iframe id='remember' name='remember' style="display:none" src='about:blank'></iframe>
    <form target='remember' method='post' action='about:blank'>
      <label for='apikey'>API Key:</label>
      <input id='apikey' type='text' name='apikey' autocomplete='on'></input>
      <br>
      <label for='example'>Example:</label>
      <select name='example' id='examples'></select>
      <br>
      <button id='run' type='submit'>Run</button>
    </form>
    <br>
    <pre id='response'></pre>
    <pre id='processed'></pre>
  </body>
  <script type='module'>
    import { makeOptions, fetcher } from './index.js'
    import { examples } from './examples.js'

    let examplesSelector = document.getElementById('examples')
    let apikey = document.getElementById('apikey')

    function execute() {
      let key = apikey.value
      let exampleName = examplesSelector.value
      if (!exampleName) {
        return
      }
      let example = examples[exampleName]
      let options = makeOptions(example.data, key)
      fetcher(example.url, options, function(data) {
        console.log('API response JSON:', data)
        document.getElementById('response').innerHTML = JSON.stringify(data, null, 2);

        if (!example.cb) {
          return
        }
        let processed = example.cb(data)
        if (processed === undefined) {
          return
        }
        console.log('Processed:', processed)
        document.getElementById('processed').innerHTML = JSON.stringify(processed, null, 2);
      })
    }

    Object.keys(examples).forEach(name => {
      let option = document.createElement('option')
      option.value = name
      option.innerHTML = name
      examplesSelector.append(option)
    })
    document.querySelector('#run').addEventListener('click', execute)
  </script>
</html>
